CREATE SCHEMA `mecanica_lamborghini`;

USE `mecanica_lamborghini`;

CREATE TABLE Usuario 
( 
 id INT PRIMARY KEY AUTO_INCREMENT,   
 TipoUser ENUM('User', 'Mec') NOT NULL,  
 Nome VARCHAR(255) NOT NULL,  
 CPF VARCHAR(11) NOT NULL,  
 Celular VARCHAR(11) NOT NULL,  
 email VARCHAR(255) NOT NULL,  
 Login VARCHAR(255) NOT NULL,  
 Senha VARCHAR(50) NOT NULL, 
 unique (login)
); 

CREATE TABLE Orcamento 
( 
 id INT PRIMARY KEY AUTO_INCREMENT,    
 TotalPeca FLOAT NOT NULL,  
 TotalServico FLOAT NOT NULL,  
 ValorTotal FLOAT NOT NULL,  
 Descricao VARCHAR(1000) NOT NULL,  
 Status VARCHAR(50) NOT NULL,  
 id_Carro INT,  
 id_Usuario INT  
); 

CREATE TABLE Carro 
( 
 id INT PRIMARY KEY AUTO_INCREMENT,   
 Modelo VARCHAR(50) NOT NULL,  
 Cor VARCHAR(50) NOT NULL,  
 Placa VARCHAR(7) NOT NULL,  
 Ano INT(4) NOT NULL,  
 Marca VARCHAR(50) NOT NULL,  
 id_Usuario INT  
); 

CREATE TABLE Servico 
( 
 id INT PRIMARY KEY AUTO_INCREMENT,  
 Nome VARCHAR(50) NOT NULL,  
 ValorUnAtual FLOAT NOT NULL,  
 UnMedida VARCHAR(20) NOT NULL 
); 

CREATE TABLE ItemServico 
( 
 id INT PRIMARY KEY AUTO_INCREMENT,    
 Qnt INT(2) NOT NULL,  
 ValorUn FLOAT NOT NULL,  
 ValorTotal FLOAT NOT NULL,  
 id_Servico INT,  
 id_Orcamento INT  
); 

CREATE TABLE ItemPeca 
( 
 id INT PRIMARY KEY AUTO_INCREMENT,   
 Qnt INT(3) NOT NULL,  
 ValorUn FLOAT NOT NULL,  
 ValorTotal FLOAT NOT NULL,  
 id_Orcamento INT,  
 id_Peca INT  
); 

CREATE TABLE Peca 
( 
 id INT PRIMARY KEY AUTO_INCREMENT,    
 Nome VARCHAR(50) NOT NULL,  
 ValorUnAtual FLOAT NOT NULL,  
 UnMedida VARCHAR(20) NOT NULL  
);

ALTER TABLE Orcamento ADD FOREIGN KEY(id_Carro) REFERENCES Carro (id);
ALTER TABLE Orcamento ADD FOREIGN KEY(id_Usuario) REFERENCES Usuario (id);
ALTER TABLE Carro ADD FOREIGN KEY(id_Usuario) REFERENCES Usuario (id);
ALTER TABLE ItemServico ADD FOREIGN KEY(id_Servico) REFERENCES Servico (id);
ALTER TABLE ItemServico ADD FOREIGN KEY(id_Orcamento) REFERENCES Orcamento (id);
ALTER TABLE ItemPeca ADD FOREIGN KEY(id_Orcamento) REFERENCES Orcamento (id);
ALTER TABLE ItemPeca ADD FOREIGN KEY(id_Peca) REFERENCES Peca (id);
